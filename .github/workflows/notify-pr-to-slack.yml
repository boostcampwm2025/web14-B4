# PR Îì±Î°ùÏãú, Slack Ï±ÑÎÑêÏóê ÏûêÎèô ÏïåÎ¶º
name: Notify PR Opened to Slack

on:
  pull_request:
    types: [opened]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send PR opened notification to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_CREATOR: ${{ github.event.pull_request.user.login }}

          BASE_BRANCH: ${{ github.event.pull_request.base.ref }}
          COMPARE_BRANCH: ${{ github.event.pull_request.head.ref }}
          LABELS: ${{ join(github.event.pull_request.labels.*.name, ', ') }}

        run: |
          if [ -z "${LABELS}" ]; then
            LABELS_TEXT=""
          else
            LABELS_TEXT=" [${LABELS}]"
          fi

          payload=$(cat <<EOF
          {
            "text": "üìù *PR ÏÉùÏÑ± ÏïåÎ¶º* \n * `${PR_CREATOR}`* ÎãòÏù¥ PRÏùÑ ÏÉùÏÑ±ÌïòÏòÄÏñ¥Ïöî. \n \n - *Ï†úÎ™©* : ${PR_TITLE}${LABELS_TEXT}\n - *Î∏åÎûúÏπò* : `${COMPARE_BRANCH}` ‚Üí `${BASE_BRANCH}` \n - *ÎßÅÌÅ¨* : ${PR_URL}"
          }
          EOF
          )

          curl -X POST \
            -H "Content-type: application/json" \
            --data "${payload}" \
            ${SLACK_WEBHOOK_URL}
